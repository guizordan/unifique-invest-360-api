{"version":3,"sources":["../../../../src/infra/http/server.ts"],"sourcesContent":["import path from \"path\";\n\nconst LOG_LEVEL =\n  (process.env.LOG_LEVEL as\n    | \"fatal\"\n    | \"error\"\n    | \"warn\"\n    | \"info\"\n    | \"debug\"\n    | \"trace\") || \"info\";\nconst NODE_ENV =\n  (process.env.NODE_ENV as \"development\" | \"production\" | \"test\" | \"local\") ||\n  \"test\";\n\nimport fastify, { FastifyInstance, RawServerDefault } from \"fastify\";\nimport cors from \"@fastify/cors\";\nimport cookie from \"@fastify/cookie\";\nimport session from \"@fastify/session\";\nimport fastifyStatic from \"@fastify/static\";\nimport fastifyMultipart from \"@fastify/multipart\";\n\nimport routes from \"@/infra/http/routes\";\nimport { handleError, handleSend } from \"@/infra/http/hooks\";\nimport { cookieSettings } from \"@/settings\";\n\nconst fastifyApp: FastifyInstance = fastify<RawServerDefault>({\n  logger: {\n    level: LOG_LEVEL,\n  },\n  disableRequestLogging: true,\n});\n\nfastifyApp.register(cookie);\nfastifyApp.register(session, {\n  cookieName: \"session\",\n  secret: process.env.SESSION_SECRET!,\n  cookie: {\n    path: cookieSettings.path,\n    httpOnly: cookieSettings.httpOnly,\n    sameSite: cookieSettings.sameSite,\n    secure: cookieSettings.secure,\n    maxAge: cookieSettings.maxAge,\n  },\n});\n\nfastifyApp.register(fastifyMultipart);\nfastifyApp.register(routes, { prefix: \"/api\" });\n\nfastifyApp.register(fastifyStatic, {\n  root: path.join(process.cwd(), \"static\"),\n  prefix: \"/static/\",\n});\n\nfastifyApp.addHook(\"onSend\", handleSend);\nfastifyApp.setErrorHandler(handleError);\n\nfastifyApp.register(cors, {\n  origin: (origin, callback) => {\n    if (NODE_ENV === \"production\") {\n      callback(null, origin === process.env.WEB_URL);\n    }\n\n    if (NODE_ENV === \"local\") {\n      callback(null, true);\n    }\n\n    if (NODE_ENV === \"test\") {\n      callback(null, true);\n    }\n  },\n  credentials: true,\n});\n\nexport default fastifyApp;\n"],"names":["path","LOG_LEVEL","process","env","NODE_ENV","fastify","cors","cookie","session","fastifyStatic","fastifyMultipart","routes","handleError","handleSend","cookieSettings","fastifyApp","logger","level","disableRequestLogging","register","cookieName","secret","SESSION_SECRET","httpOnly","sameSite","secure","maxAge","prefix","root","join","cwd","addHook","setErrorHandler","origin","callback","WEB_URL","credentials"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AAExB,MAAMC,YACJ,AAACC,QAAQC,GAAG,CAACF,SAAS,IAMN;AAClB,MAAMG,WACJ,AAACF,QAAQC,GAAG,CAACC,QAAQ,IACrB;AAEF,OAAOC,aAAoD,UAAU;AACrE,OAAOC,UAAU,gBAAgB;AACjC,OAAOC,YAAY,kBAAkB;AACrC,OAAOC,aAAa,mBAAmB;AACvC,OAAOC,mBAAmB,kBAAkB;AAC5C,OAAOC,sBAAsB,qBAAqB;AAElD,OAAOC,YAAY,sBAAsB;AACzC,SAASC,WAAW,EAAEC,UAAU,QAAQ,qBAAqB;AAC7D,SAASC,cAAc,QAAQ,aAAa;AAE5C,MAAMC,aAA8BV,QAA0B;IAC5DW,QAAQ;QACNC,OAAOhB;IACT;IACAiB,uBAAuB;AACzB;AAEAH,WAAWI,QAAQ,CAACZ;AACpBQ,WAAWI,QAAQ,CAACX,SAAS;IAC3BY,YAAY;IACZC,QAAQnB,QAAQC,GAAG,CAACmB,cAAc;IAClCf,QAAQ;QACNP,MAAMc,eAAed,IAAI;QACzBuB,UAAUT,eAAeS,QAAQ;QACjCC,UAAUV,eAAeU,QAAQ;QACjCC,QAAQX,eAAeW,MAAM;QAC7BC,QAAQZ,eAAeY,MAAM;IAC/B;AACF;AAEAX,WAAWI,QAAQ,CAACT;AACpBK,WAAWI,QAAQ,CAACR,QAAQ;IAAEgB,QAAQ;AAAO;AAE7CZ,WAAWI,QAAQ,CAACV,eAAe;IACjCmB,MAAM5B,KAAK6B,IAAI,CAAC3B,QAAQ4B,GAAG,IAAI;IAC/BH,QAAQ;AACV;AAEAZ,WAAWgB,OAAO,CAAC,UAAUlB;AAC7BE,WAAWiB,eAAe,CAACpB;AAE3BG,WAAWI,QAAQ,CAACb,MAAM;IACxB2B,QAAQ,CAACA,QAAQC;QACf,IAAI9B,aAAa,cAAc;YAC7B8B,SAAS,MAAMD,WAAW/B,QAAQC,GAAG,CAACgC,OAAO;QAC/C;QAEA,IAAI/B,aAAa,SAAS;YACxB8B,SAAS,MAAM;QACjB;QAEA,IAAI9B,aAAa,QAAQ;YACvB8B,SAAS,MAAM;QACjB;IACF;IACAE,aAAa;AACf;AAEA,eAAerB,WAAW"}