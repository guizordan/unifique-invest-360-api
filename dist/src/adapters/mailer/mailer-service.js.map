{"version":3,"sources":["../../../../src/adapters/mailer/mailer-service.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\n\nimport { MailerSend, EmailParams, Sender, Recipient } from \"mailersend\";\nimport { ADMIN_SENDER, MAILER_KEY, NODE_ENV } from \"@/settings\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst mailerSend = new MailerSend({\n  apiKey: MAILER_KEY,\n});\n\ninterface EmailInput {\n  recipient: string;\n  subject: string;\n  htmlContent: string;\n}\n\nexport function createEmailParams({\n  recipient,\n  subject,\n  htmlContent,\n}: EmailInput): EmailParams {\n  const sentFrom = new Sender(ADMIN_SENDER, \"unifique\");\n  const recipients = [new Recipient(recipient)];\n\n  return new EmailParams()\n    .setFrom(sentFrom)\n    .setTo(recipients)\n    .setReplyTo(sentFrom)\n    .setSubject(subject)\n    .setHtml(htmlContent);\n}\n\nexport async function sendOrLogEmail(emailParams: EmailParams): Promise<void> {\n  if (NODE_ENV === \"prod\") {\n    try {\n      await mailerSend.email.send(emailParams);\n    } catch (error) {\n      console.error(\"Failed to send email:\", error);\n      throw error;\n    }\n  } else {\n    console.log(\"ðŸ“§ Email preview (not sent in non-prod env):\");\n    console.log(\"From:\", emailParams.from.email);\n    console.log(\"To:\", emailParams.to.map((r) => r.email).join(\", \"));\n    console.log(\"Subject:\", emailParams.subject);\n    console.log(\"HTML Content:\", emailParams.html);\n  }\n}\n\nexport function replacePlaceholders(\n  emailTemplateName: string,\n  replacements: Record<string, string>\n): string {\n  const emailTemplatePath = path.join(\n    __dirname,\n    \"..\",\n    \"assets\",\n    `${emailTemplateName}.html`\n  );\n\n  if (!fs.existsSync(emailTemplatePath)) {\n    throw new Error(`Email template not found: ${emailTemplatePath}`);\n  }\n\n  const template = fs.readFileSync(emailTemplatePath, \"utf-8\");\n\n  return Object.entries(replacements).reduce((result, [placeholder, value]) => {\n    return result.replace(new RegExp(`\\\\[${placeholder}\\\\]`, \"g\"), value);\n  }, template);\n}\n"],"names":["fs","path","fileURLToPath","MailerSend","EmailParams","Sender","Recipient","ADMIN_SENDER","MAILER_KEY","NODE_ENV","__filename","url","__dirname","dirname","mailerSend","apiKey","createEmailParams","recipient","subject","htmlContent","sentFrom","recipients","setFrom","setTo","setReplyTo","setSubject","setHtml","sendOrLogEmail","emailParams","email","send","error","console","log","from","to","map","r","join","html","replacePlaceholders","emailTemplateName","replacements","emailTemplatePath","existsSync","Error","template","readFileSync","Object","entries","reduce","result","placeholder","value","replace","RegExp"],"mappings":"AAAA,OAAOA,QAAQ,KAAK;AACpB,OAAOC,UAAU,OAAO;AACxB,SAASC,aAAa,QAAQ,MAAM;AAEpC,SAASC,UAAU,EAAEC,WAAW,EAAEC,MAAM,EAAEC,SAAS,QAAQ,aAAa;AACxE,SAASC,YAAY,EAAEC,UAAU,EAAEC,QAAQ,QAAQ,aAAa;AAEhE,MAAMC,aAAaR,cAAc,YAAYS,GAAG;AAChD,MAAMC,YAAYX,KAAKY,OAAO,CAACH;AAE/B,MAAMI,aAAa,IAAIX,WAAW;IAChCY,QAAQP;AACV;AAQA,OAAO,SAASQ,kBAAkB,EAChCC,SAAS,EACTC,OAAO,EACPC,WAAW,EACA;IACX,MAAMC,WAAW,IAAIf,OAAOE,cAAc;IAC1C,MAAMc,aAAa;QAAC,IAAIf,UAAUW;KAAW;IAE7C,OAAO,IAAIb,cACRkB,OAAO,CAACF,UACRG,KAAK,CAACF,YACNG,UAAU,CAACJ,UACXK,UAAU,CAACP,SACXQ,OAAO,CAACP;AACb;AAEA,OAAO,eAAeQ,eAAeC,WAAwB;IAC3D,IAAInB,aAAa,QAAQ;QACvB,IAAI;YACF,MAAMK,WAAWe,KAAK,CAACC,IAAI,CAACF;QAC9B,EAAE,OAAOG,OAAO;YACdC,QAAQD,KAAK,CAAC,yBAAyBA;YACvC,MAAMA;QACR;IACF,OAAO;QACLC,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC,SAASL,YAAYM,IAAI,CAACL,KAAK;QAC3CG,QAAQC,GAAG,CAAC,OAAOL,YAAYO,EAAE,CAACC,GAAG,CAAC,CAACC,IAAMA,EAAER,KAAK,EAAES,IAAI,CAAC;QAC3DN,QAAQC,GAAG,CAAC,YAAYL,YAAYV,OAAO;QAC3Cc,QAAQC,GAAG,CAAC,iBAAiBL,YAAYW,IAAI;IAC/C;AACF;AAEA,OAAO,SAASC,oBACdC,iBAAyB,EACzBC,YAAoC;IAEpC,MAAMC,oBAAoB1C,KAAKqC,IAAI,CACjC1B,WACA,MACA,UACA,GAAG6B,kBAAkB,KAAK,CAAC;IAG7B,IAAI,CAACzC,GAAG4C,UAAU,CAACD,oBAAoB;QACrC,MAAM,IAAIE,MAAM,CAAC,0BAA0B,EAAEF,mBAAmB;IAClE;IAEA,MAAMG,WAAW9C,GAAG+C,YAAY,CAACJ,mBAAmB;IAEpD,OAAOK,OAAOC,OAAO,CAACP,cAAcQ,MAAM,CAAC,CAACC,QAAQ,CAACC,aAAaC,MAAM;QACtE,OAAOF,OAAOG,OAAO,CAAC,IAAIC,OAAO,CAAC,GAAG,EAAEH,YAAY,GAAG,CAAC,EAAE,MAAMC;IACjE,GAAGP;AACL"}